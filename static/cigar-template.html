<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{BRAND}} {{LINE}} Prices - Compare Deals | Cigar Price Scout</title>
    
     <meta name="description"
        content="Compare {{BRAND}} {{LINE}} cigar box prices across 35+ online retailers. Find the best deals with shipping and tax calculations when you visit cigarpricescout.com." />
      
    <link rel="canonical"
        href="https://cigarpricescout.com/cigars/{{BRAND_SLUG}}/{{LINE_SLUG}}" />
    
    <!-- Same styling as your index.html -->
    <link rel="icon" type="image/png" href="/static/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet" />
    
    <!-- Complete CSS including mobile responsiveness -->
    <style>
      :root{
        --ink:#111;
        --muted:#4b5563;
        --rule:#e5e7eb;
        --accent:#7c5c2e;
      }

      body{
        margin:0;
        color:var(--ink);
        background:#faf7f2;
        font-family:"Cormorant Garamond", serif;
        font-size:18px;
        line-height:1.5;
      }
      
      .wrap{max-width:900px;margin:0 auto;padding:0 20px}
      
      .heroheader{
        display:flex;flex-direction:column;align-items:center;justify-content:center;
        gap:8px;padding:28px 0 10px;text-align:center;
      }
      
      .scout-hat{width:100px;height:80px;object-fit:contain}
      
      .brandname{
        font-family:"Cinzel", serif;
        font-weight:700;
        letter-spacing:.4px;
        font-size:28px;
      }
      
      .tag{
        font-style:italic;
        color:var(--muted);
        font-size:20px;
        margin-top:2px;
      }
      
      h2{font-family:"Cinzel", serif;font-weight:700;letter-spacing:.3px;margin:18px 0 8px;font-size:24px;text-align:center}
      
      /* Desktop table styles */
      .price-table-container {
        overflow-x: auto;
      }
      
      table{
        width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--rule);
        border-radius:12px;overflow:hidden;margin-top:20px;
        box-shadow:0 1px 3px rgba(0,0,0,0.05);
      }
      
      th,td{
        padding:20px 16px;border-bottom:1px solid var(--rule);text-align:center;
        font-size:18px;line-height:1.6;
      }
      
      th{
        background:#fcfbf9;color:var(--ink);font-family:"Cinzel", serif;
        font-weight:600;font-size:16px;letter-spacing:0.3px;
      }
      
      td{color:var(--ink);background:#fff}
      
      td a{color:var(--accent);text-decoration:none;font-weight:600;font-size:19px}
      td a:hover{text-decoration:underline}
      
      .price-cell{
        font-weight:600;
        font-size:20px;
      }
      
      .total-price{
        font-weight:700;
        font-size:21px;
        color:var(--accent);
      }
      
      .best-total {
        color: #059669 !important;
        font-weight: 700 !important;
      }

      .oos{color:#dc2626;font-weight:600;font-size:14px;text-transform:uppercase}

      /* Mobile card styles */
      .mobile-cards {
        display: none;
      }
      
      .price-card {
        background: #fff;
        border: 1px solid var(--rule);
        border-radius: 12px;
        margin: 15px 0;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--rule);
      }
      
      .card-retailer {
        font-family: "Cinzel", serif;
        font-weight: 600;
        font-size: 18px;
        color: var(--ink);
      }
      
      .card-price {
        font-size: 22px;
        font-weight: 700;
        color: var(--accent);
      }
      
      .card-details {
        margin: 15px 0;
      }
      
      .card-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f3f4f6;
      }
      
      .card-label {
        color: var(--muted);
        font-weight: 500;
      }
      
      .card-value {
        font-weight: 600;
        color: var(--ink);
      }
      
      .card-button {
        display: block;
        width: calc(100% - 60px);
        margin: 20px 30px 0 30px;
        padding: 15px;
        background: var(--accent);
        color: white;
        text-decoration: none;
        text-align: center;
        border-radius: 12px;
        font-weight: 600;
        font-size: 18px;
        transition: all 0.3s;
        box-sizing: border-box;
      }
      
      .card-button:hover {
        filter: brightness(0.95);
        color: white;
        text-decoration: none;
      }

      .cta{border:none;border-radius:12px;padding:12px 24px;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;margin:20px auto;display:block}
      .cta:hover{filter:brightness(.95)}

      .footer{margin-top:40px;padding:20px 0;border-top:1px solid var(--rule);text-align:center;color:var(--muted);font-size:16px}
      .footer a{color:var(--accent);text-decoration:none}
      .footer a:hover{text-decoration:underline}
      
      /* Responsive breakpoints */
      @media(max-width:768px){
        .heroheader{padding:20px 0 8px}
        .brandname{font-size:24px}
        .tag{font-size:18px}
        
        .hide-tablet {
          display: none;
        }
      }
      
      @media(max-width:480px){
        .price-table-container {
          display: none;
        }
        
        .mobile-cards {
          display: block;
        }
        
        .price-card {
          margin: 10px -10px;
          border-radius: 0;
          border-left: none;
          border-right: none;
        }

        .heroheader {
          text-align: center;
        }
  
        .brandname, .tag {
          text-align: center;
        }
      }
    </style>

      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "{{BRAND}} {{LINE}}",
        "url": "https://cigarpricescout.com/cigars/{{BRAND_SLUG}}/{{LINE_SLUG}}",
        "brand": {
          "@type": "Brand",
          "name": "{{BRAND}}"
        },
        "description": "Compare {{BRAND}} {{LINE}} cigar prices across 35+ online retailers",
        "offers": {
          "@type": "AggregateOffer",
          "priceCurrency": "USD",
          "lowPrice": "0",
          "highPrice": "1000",
          "offerCount": "35"
        }
      }
      
  </script>

    <meta property="og:title" content="{{BRAND}} {{LINE}} Prices - Compare Deals | Cigar Price Scout" />
    <meta property="og:description" content="Compare {{BRAND}} {{LINE}} cigar prices across 35+ online retailers." />
    <meta property="og:url" content="https://cigarpricescout.com/cigars/{{BRAND_SLUG}}/{{LINE_SLUG}}" />
    <meta property="og:type" content="product" />
    <meta property="og:image" content="https://cigarpricescout.com/static/logo.png" />

    <meta name="twitter:card" content="summary_large_image" />

   </head>

  <body>
    <div style="text-align:center;font-size:14px;color:#6b7280;margin:10px 0;">
      <a href="/" style="color:var(--accent);">Home</a> > 
      <span>{{BRAND}}</span> > 
      <span>{{LINE}}</span>
    </div>
  
    <!-- Age Verification Modal -->
    <div id="ageModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;">
      <div style="background:#fff;padding:40px;border-radius:12px;text-align:center;max-width:400px;margin:20px;">
        <h2 style="font-family:'Cinzel',serif;margin-bottom:20px;">Age Verification Required</h2>
        <p style="margin-bottom:30px;font-size:18px;line-height:1.5;">You must be 21 years or older to view cigar pricing information. Please confirm your age to continue.</p>
        <div style="display:flex;gap:15px;justify-content:center;">
          <button onclick="confirmAge()" style="background:var(--accent);color:#fff;padding:12px 24px;border:none;border-radius:8px;font-size:16px;cursor:pointer;">I am 21 or older</button>
          <button onclick="denyAge()" style="background:#dc2626;color:#fff;padding:12px 24px;border:none;border-radius:8px;font-size:16px;cursor:pointer;">I am under 21</button>
        </div>
      </div>
    </div>

    <div class="wrap">
      <header class="heroheader">
        <img src="/static/logo.png" alt="Cigar Price Scout Logo" class="scout-hat" />
        <h1 class="brandname">Cigar Price Scout</h1>
        <p class="tag">{{BRAND}} {{LINE}} - Price Comparison</p>
      </header>
      
      <div style="text-align:center;margin:0px 0;">
        <a href="/" style="display:inline-block;border:none;border-radius:12px;padding:12px 24px;font-weight:700;background:var(--accent);color:#fff;text-decoration:none;font-family:'Cormorant Garamond',serif;font-size:18px;">Scout Other Cigar Boxes</a>
      </div>

      <p style="text-align:center;color:var(--muted);font-size:18px;font-weight:600;margin-top:24px;">
        Want shipping, tax, and promo calculations? Run a full comparison on our homepage.
      </p>

      <main>
        <section id="results">

          <h2 id="resultsTitle">
            {{BRAND}} {{LINE}} – Advertised Box Prices
          </h2>

          <p id="resultsSummary" 
                style="text-align:center;color:#4b5563;font-size:16px;margin-top:4px;">
              Loading cigar details…
          </p>

          <div style="display:flex;gap:12px;justify-content:center;margin:20px 0;flex-wrap:wrap;">
            <select id="wrapperFilter" style="padding:10px 14px;border:1px solid #e5e7eb;border-radius:8px;font-family:'Cormorant Garamond',serif;font-size:16px;background:#fff;">
              <option value="">All Wrappers</option>
            </select>
            <select id="vitolaFilter" style="padding:10px 14px;border:1px solid #e5e7eb;border-radius:8px;font-family:'Cormorant Garamond',serif;font-size:16px;background:#fff;">
              <option value="">All Vitolas</option>
            </select>
            <button onclick="clearFilters()" style="padding:10px 20px;border:1px solid var(--accent);border-radius:8px;background:#fff;color:var(--accent);cursor:pointer;font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:600;">Clear Filters</button>
          </div>

          <!-- Desktop Table -->
          <div class="price-table-container">
            <table id="resultsTable">
              <thead>
                <tr>
                  <th>Retailer</th>
                  <th>Product Details</th>
                  <th>Advertised Price</th>
                  <th>Stock Status</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4">Loading...</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- Mobile Cards -->
          <div id="mobileCards" class="mobile-cards">
            <!-- Mobile cards populated by JavaScript -->
          </div>
        </section>
        
      </main>
      
      <footer class="footer">
        <p>
          <a href="/about.html">About</a> | 
          <a href="/privacy-policy.html">Privacy</a> | 
          <a href="/terms-of-service.html">Terms</a> | 
          <a href="/contact.html">Contact</a>
        </p>
        <p>&copy; 2025 Cigar Price Scout</p>
      </footer>
    </div>

    <script>
      let allResults = [];
      
      // Extract brand and line from URL path and convert to proper title case
      const pathParts = window.location.pathname.split('/');
      const brandSlug = pathParts[2] || '';
      const lineSlug = pathParts[3] || '';
      
      // Convert slugs to title case properly
      function toTitleCase(str) {
        return str.replace(/-/g, ' ')
                 .split(' ')
                 .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                 .join(' ');
      }
      
      const brand = toTitleCase(brandSlug);
      const line = toTitleCase(lineSlug);
      
      // Fetch prices on page load
      async function loadPrices() {
        try {
          const params = new URLSearchParams({ brand, line });
          
          const response = await fetch('/compare-all?' + params.toString());
          const data = await response.json();
          
          displayResults(data);
        } catch (error) {
          console.error('Error loading prices:', error);
          document.querySelector('#resultsTable tbody').innerHTML = 
            '<tr><td colspan="4">Error loading prices. Please try again.</td></tr>';
          document.getElementById('mobileCards').innerHTML = 
            '<div class="price-card">Error loading prices. Please try again.</div>';
        }
      }
      
      function displayResults(data) {
        const titleEl = document.getElementById('resultsTitle');
        const metaDesc = document.querySelector('meta[name="description"]');

        // No results
        if (!data.results || data.results.length === 0) {
            if (titleEl) {
                titleEl.textContent = 'No results found';
            }
            document.querySelector('#resultsTable tbody').innerHTML = 
                '<tr><td colspan="4">No matching cigars found.</td></tr>';
            document.getElementById('mobileCards').innerHTML = 
                '<div class="price-card">No matching cigars found.</div>';
            return;
        }

        // Sort by delivered price
        data.results.sort((a, b) => {
            const priceA = parseFloat(a.delivered_after_promo.replace("$", ""));
            const priceB = parseFloat(b.delivered_after_promo.replace("$", ""));
            return priceA - priceB;
        });

        allResults = data.results;

        // SEO enrichment (wrapper/vitola in title/meta)
        const wrappers = new Set();
        const vitolas = new Set();

        data.results.forEach(r => {
            if (r.wrapper) wrappers.add(r.wrapper);
            if (r.vitola) vitolas.add(r.vitola);
        });

        const wrapperText =
            wrappers.size === 1 ? ` ${[...wrappers][0]} wrapper` : '';
        const vitolaText =
            vitolas.size === 1 ? ` ${[...vitolas][0]}` : '';

        const seoTitle =
            `${data.brand} ${data.line}${wrapperText}${vitolaText} Prices - Compare Deals | Cigar Price Scout`;

        const seoDesc =
            `Compare ${data.brand} ${data.line}${wrapperText}${vitolaText} cigar prices across 35+ online retailers with shipping and tax included.`;

        document.title = seoTitle;
        if (metaDesc) metaDesc.setAttribute('content', seoDesc);

        // Summary block
        const summaryEl = document.getElementById('resultsSummary');
        if (summaryEl) {
            const wrapperList = Array.from(wrappers).sort().join(', ');
            const vitolaList = Array.from(vitolas).sort().join(', ');

            let summary = `We found ${data.results.length} ${data.brand} ${data.line} box listings`;

            if (wrapperList) summary += ` in wrappers such as ${wrapperList}`;
            if (vitolaList) summary += ` and vitolas like ${vitolaList}`;

            summary += `. Use the filters below to explore wrappers and vitolas. For ZIP-code-based shipping, promotions, and tax estimates, click the Scout Other Cigar Boxes button.`;

            summaryEl.textContent = summary;
        }

        // Update page heading
        if (titleEl) {
            titleEl.textContent = `${data.brand} ${data.line} – Advertised Box Prices`;
        }

        // Populate filter dropdowns
        populateFilters(data.results);

        // Render initial table and mobile cards
        renderTable(data.results);
        renderMobileCards(data.results);
    }

      
      function populateFilters(results) {
        const wrappers = new Set();
        const vitolas = new Set();
        
        results.forEach(r => {
          if (r.wrapper) wrappers.add(r.wrapper);
          if (r.vitola) vitolas.add(r.vitola);
        });
        
        const wrapperFilter = document.getElementById('wrapperFilter');
        const vitolaFilter = document.getElementById('vitolaFilter');
        
        wrapperFilter.innerHTML = '<option value="">All Wrappers</option>' +
          Array.from(wrappers).sort().map(w => `<option value="${w}">${w}</option>`).join('');
        
        vitolaFilter.innerHTML = '<option value="">All Vitolas</option>' +
          Array.from(vitolas).sort().map(v => `<option value="${v}">${v}</option>`).join('');
        
        // Add event listeners
        wrapperFilter.addEventListener('change', applyFilters);
        vitolaFilter.addEventListener('change', applyFilters);
      }
      
      function applyFilters() {
        const wrapperVal = document.getElementById('wrapperFilter').value;
        const vitolaVal = document.getElementById('vitolaFilter').value;
        
        const filtered = allResults.filter(r => {
          if (wrapperVal && r.wrapper !== wrapperVal) return false;
          if (vitolaVal && r.vitola !== vitolaVal) return false;
          return true;
        });
        
        renderTable(filtered);
        renderMobileCards(filtered);
      }
      
      function clearFilters() {
        document.getElementById('wrapperFilter').value = '';
        document.getElementById('vitolaFilter').value = '';
        renderTable(allResults);
        renderMobileCards(allResults);
      }
      
      function renderTable(results) {
        const tbody = document.querySelector('#resultsTable tbody');
        
        if (results.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4">No results match your filters.</td></tr>';
          return;
        }
        
        tbody.innerHTML = results.map(result => 
          `<tr>
            <td><a href="${result.url}" target="_blank">${result.retailer}</a></td>

            <td style="text-align:left;min-width:220px;padding:16px;">
              <div style="font-size:15px;color:#6b7280;line-height:1.8;">
                ${result.wrapper ? `<div>Wrapper: ${result.wrapper}</div>` : ''}
                ${result.vitola ? `<div>Vitola: ${result.vitola}</div>` : ''}
                <div>Box of ${result.box_qty}</div>
              </div>
            </td>

            <td class="price-cell">${result.base}</td>

            <td class="price-cell">
              ${result.oos 
                ? '<span class="oos">Out of Stock</span>' 
                : '<span style="color:#059669;font-weight:600;">In Stock</span>'}
            </td>
          </tr>`
        ).join('');
      }

      function renderMobileCards(results) {
        const mobileContainer = document.getElementById('mobileCards');
        
        if (results.length === 0) {
          mobileContainer.innerHTML = '<div class="price-card">No results match your filters.</div>';
          return;
        }
        
        mobileContainer.innerHTML = results.map(result => 
          `<div class="price-card">
            <div class="card-header">
              <div class="card-retailer">${result.retailer}</div>
              <div class="card-price">${result.base}</div>
            </div>
            
            <div class="card-details">
              ${result.wrapper ? `
                <div class="card-item">
                  <span class="card-label">Wrapper:</span>
                  <span class="card-value">${result.wrapper}</span>
                </div>` : ''}
              ${result.vitola ? `
                <div class="card-item">
                  <span class="card-label">Vitola:</span>
                  <span class="card-value">${result.vitola}</span>
                </div>` : ''}
              <div class="card-item">
                <span class="card-label">Box Size:</span>
                <span class="card-value">${result.box_qty}</span>
              </div>
              <div class="card-item">
                <span class="card-label">Stock:</span>
                <span class="card-value">
                  ${result.oos 
                    ? '<span style="color: #dc2626; font-weight: 600;">Out of Stock</span>' 
                    : '<span style="color: #059669; font-weight: 600;">In Stock</span>'}
                </span>
              </div>
            </div>
            
            <a href="${result.url}" class="card-button" target="_blank" rel="noopener">
              View at ${result.retailer}
            </a>
          </div>`
        ).join('');
      }

      // Age verification
      let ageVerified = false;
      
      function showAgeModal() {
        if (!ageVerified) {
          document.getElementById('ageModal').style.display = 'flex';
        }
      }
      
      function confirmAge() {
        ageVerified = true;
        document.getElementById('ageModal').style.display = 'none';
      }
      
      function denyAge() {
        alert('You must be 21 or older to access this site.');
        window.location.href = 'https://www.google.com';
      }
      
      window.addEventListener('load', function() {
        showAgeModal();
        loadPrices();
      });
    </script>
  </body>
</html>
