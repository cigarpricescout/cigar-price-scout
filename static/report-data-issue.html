<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Report a Data Issue | Cigar Price Scout</title>
  <meta name="description" content="Report pricing or product data issues to help improve Cigar Price Scout's accuracy." />
  <link rel="canonical" href="https://cigarpricescout.com/report-data-issue.html" />
  <link rel="icon" type="image/png" href="/static/logo.png">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50: '#faf7f2', 500: '#7c5c2e', 600: '#6b4f27' },
            ink: '#111111',
            muted: '#4b5563',
          },
          fontFamily: {
            serif: ['Cormorant Garamond', 'Georgia', 'serif'],
            display: ['Cinzel', 'Georgia', 'serif'],
          },
        },
      },
    }
  </script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet" />
</head>

<body class="bg-brand-50 font-serif text-ink text-lg leading-relaxed">
  <div class="max-w-3xl mx-auto px-5">
    
    <!-- Header -->
    <header class="flex flex-col items-center justify-center gap-2 py-7 text-center">
      <img src="/static/logo.png" alt="Cigar Price Scout Logo" class="w-20 h-16 object-contain" />
      <h1 class="font-display font-bold text-2xl tracking-wide">Report a Data Issue</h1>
      <p class="italic text-muted text-lg">Help us keep our pricing data accurate and up-to-date</p>
    </header>
    
    <!-- Back Link -->
    <a href="/" class="inline-block text-brand-500 font-semibold hover:underline mb-5">&larr; Back to Price Scout</a>
    
    <!-- Form -->
    <form id="issueReportForm" class="bg-white border border-gray-200 rounded-xl p-8 shadow-sm mb-8">
      <div class="mb-6">
        <label class="block font-display font-semibold mb-2">Search Context <span class="text-red-500">*</span></label>
        <div id="contextDisplay" class="bg-gray-100 p-4 rounded-lg font-mono text-sm text-gray-600 mb-2">
          Loading search context...
        </div>
        <input type="hidden" id="searchContext" name="searchContext" required />
      </div>
      
      <div class="mb-6">
        <label for="retailer" class="block font-display font-semibold mb-2">Which retailer has the issue? <span class="text-red-500">*</span></label>
        <select id="retailer" name="retailer" required
                class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all">
          <option value="">Select retailer...</option>
          <option value="Multiple Retailers">Multiple Retailers</option>
          <option value="General Issue">General Issue (not retailer-specific)</option>
        </select>
      </div>
      
      <div class="mb-6">
        <label for="issueType" class="block font-display font-semibold mb-2">What type of issue is this? <span class="text-red-500">*</span></label>
        <select id="issueType" name="issueType" required
                class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all">
          <option value="">Select issue type...</option>
          <option value="Incorrect Price">Incorrect Price</option>
          <option value="Wrong Stock Status">Wrong Stock Status</option>
          <option value="Incorrect Product Details">Incorrect Product Details (wrapper, vitola, etc.)</option>
          <option value="Missing Product">Missing Product</option>
          <option value="Website/Link Issue">Website/Link Issue</option>
          <option value="Other">Other</option>
        </select>
      </div>
      
      <div class="mb-6">
        <label for="problemDescription" class="block font-display font-semibold mb-2">Describe the problem <span class="text-red-500">*</span></label>
        <textarea id="problemDescription" name="problemDescription" rows="4" required
                  placeholder="Please describe the specific issue you found. Be as detailed as possible..."
                  class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all resize-none"></textarea>
      </div>
      
      <div class="mb-6">
        <label for="recommendedSolution" class="block font-display font-semibold mb-2">What should the correct information be? <span class="text-red-500">*</span></label>
        <textarea id="recommendedSolution" name="recommendedSolution" rows="4" required
                  placeholder="Tell us what you think the correct price, stock status, or product details should be..."
                  class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all resize-none"></textarea>
      </div>
      
      <div class="mb-6">
        <label for="name" class="block font-display font-semibold mb-2">Your Name <span class="text-red-500">*</span></label>
        <input type="text" id="name" name="name" required
               class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all">
      </div>
      
      <div class="mb-6">
        <label for="email" class="block font-display font-semibold mb-2">Your Email <span class="text-red-500">*</span></label>
        <input type="email" id="email" name="email" required
               class="w-full p-3 border border-gray-200 rounded-xl bg-white font-serif text-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all">
      </div>
      
      <div class="text-center mt-8">
        <button type="submit" id="submitBtn"
                class="bg-brand-500 hover:bg-brand-600 text-white font-semibold py-4 px-8 rounded-xl transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
          Submit Issue Report
        </button>
      </div>
    </form>
    
    <div id="messageArea"></div>
    
    <!-- Footer -->
    <footer class="mt-10 py-5 border-t border-gray-200 text-center text-muted text-sm">
      <p class="space-x-2">
        <a href="/about.html" class="text-brand-500 hover:underline">About</a>
        <span>|</span>
        <a href="/privacy-policy.html" class="text-brand-500 hover:underline">Privacy</a>
        <span>|</span>
        <a href="/terms-of-service.html" class="text-brand-500 hover:underline">Terms</a>
        <span>|</span>
        <a href="/contact.html" class="text-brand-500 hover:underline">Contact</a>
      </p>
      <p class="mt-2">&copy; 2025 Cigar Price Scout</p>
    </footer>
  </div>

  <script>
    // Load context from sessionStorage
    window.addEventListener('load', function() {
      const contextData = sessionStorage.getItem('reportIssueContext');
      
      if (contextData) {
        const context = JSON.parse(contextData);
        document.getElementById('contextDisplay').textContent = context.searchContext;
        document.getElementById('searchContext').value = context.searchContext;
        populateRetailerDropdown(context.currentResults);
        window.reportContext = context;
      } else {
        document.getElementById('contextDisplay').textContent = 'No search context available - general feedback form';
        document.getElementById('searchContext').value = 'General website feedback';
      }
    });
    
    function populateRetailerDropdown(results) {
      const retailerSelect = document.getElementById('retailer');
      
      if (results && results.length > 0) {
        const retailers = [...new Set(results.map(r => r.retailer))].sort();
        retailers.forEach(retailer => {
          const option = document.createElement('option');
          option.value = retailer;
          option.textContent = retailer;
          retailerSelect.appendChild(option);
        });
      }
    }
    
    // Handle form submission
    document.getElementById('issueReportForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const messageArea = document.getElementById('messageArea');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      messageArea.innerHTML = '';
      
      try {
        const formData = {
          search_context: document.getElementById('searchContext').value,
          retailer: document.getElementById('retailer').value,
          issue_type: document.getElementById('issueType').value,
          problem_description: document.getElementById('problemDescription').value,
          recommended_solution: document.getElementById('recommendedSolution').value,
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          current_url: window.reportContext ? window.reportContext.currentUrl : window.location.href,
          timestamp: window.reportContext ? window.reportContext.timestamp : new Date().toISOString()
        };
        
        const response = await fetch('/api/data-issue-report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
          messageArea.innerHTML = '<div class="bg-emerald-50 border border-emerald-500 text-emerald-700 p-4 rounded-lg text-center font-semibold">' + result.message + '</div>';
          document.getElementById('issueReportForm').reset();
          sessionStorage.removeItem('reportIssueContext');
        } else {
          messageArea.innerHTML = '<div class="bg-red-50 border border-red-500 text-red-700 p-4 rounded-lg text-center font-semibold">' + result.message + '</div>';
        }
        
      } catch (error) {
        console.error('Submission error:', error);
        messageArea.innerHTML = '<div class="bg-red-50 border border-red-500 text-red-700 p-4 rounded-lg text-center font-semibold">There was an error submitting your report. Please try again.</div>';
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Issue Report';
      messageArea.scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
